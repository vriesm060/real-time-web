<!DOCTYPE html>
<html lang="en">

  <% include head.ejs %>

  <body>

    <ul id="messages"></ul>
    <form action="/chat">
      <input id="m" autocomplete="off">
      <button type="submit">Send</button>
    </form>

    <form action="/">
      <button type="submit" name="logout" value="true">Logout</button>
    </form>

    <script src="/socket.io/socket.io.js"></script>
    <script>
      var query = window.location.search;
      var socket = io(`/chat${query}`);
      var m = document.getElementById('m');
      var messages = document.getElementById('messages');

      m.parentNode.addEventListener('submit', function (e) {
        io('/chat').emit('chat message', m.value);
        m.value = '';
        e.preventDefault();
      }, false);

      socket.on('chat message', function(msg) {
        var li = document.createElement('li');
        li.textContent = `${msg.username}: ${msg.msg}`;
        messages.appendChild(li);
      });
    </script>
  </body>
</html>
